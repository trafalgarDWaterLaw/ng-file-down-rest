{"version":3,"file":"ng-file-down-rest.js","sources":["ng://ng-file-down-rest/lib/ng-file-down-rest.service.ts","ng://ng-file-down-rest/lib/ng-file-down-rest.component.ts","ng://ng-file-down-rest/lib/ng-file-down-rest.module.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class NgFileDownRestService {\n\n  constructor() { }\n}\n","import { Component, OnInit, AfterViewInit, OnDestroy, Input, EventEmitter, Output, ElementRef, ViewChild, Inject} from '@angular/core';\nimport { DOCUMENT } from '@angular/common';\n@Component({\n  selector: 'ng-file-down-rest',\n  templateUrl: './ng-file-down-rest.component.html',\n  styleUrls: []\n})\nexport class NgFileDownRestComponent implements OnInit, AfterViewInit, OnDestroy  {\n  @Input() urlPath: string;\n  @Input() methodType: string = 'GET';\n  @Input() fileName: string = 'myFile';\n  @Input() params: any;\n  @Input() header: any;\n  @Input() tagName: string = 'Download';\n  @Input() styleCss: string;\n  @Output() response = new EventEmitter<any>();\n  @ViewChild('ngFileLinkRest', {static: false}) anchorElement: ElementRef;\n  blobUrl = '';\n  message = {\"success\": true};\n\n\n  ngOnInit() {\n\n  }\n\n  constructor(@Inject(DOCUMENT) private document) { }\n\n  ngAfterViewInit() {\n    if (!this.styleCss) {\n      this.anchorElement.nativeElement.style.color = '#6475FF';\n    } else {\n      this.anchorElement.nativeElement.style = this.styleCss;\n    }\n  }\n  handleDownload(event) {\n    if (this.methodType === \"POST\") {\n      event.preventDefault();\n      if (this.urlPath) {\n        this.makeApiCall();\n      }\n    } else {\n      this.response.emit(this.message);\n    }\n  }\n\n  makeApiCall() {\n    let xhr = new XMLHttpRequest();\n    xhr.open('POST', this.urlPath);\n    let headerObject = {}\n    if (this.header) {\n      headerObject = JSON.parse(this.header);\n    }\n    if (headerObject) {\n      for (const property in headerObject) {\n        xhr.setRequestHeader(`${property}`, `${headerObject[property]}`);\n      }\n    } else {\n      xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n      xhr.setRequestHeader(\"cache-control\", \"no-cache\");\n    }\n    xhr.responseType = 'blob';\n    let that = this;\n    xhr.onreadystatechange = function() {\n      if (this.readyState === 4) {\n        let contentType = xhr.getResponseHeader(\"Content-Type\") ? xhr.getResponseHeader(\"Content-Type\") : 'text/plain';\n        if (contentType) {\n          let blob = new Blob([this.response], {type: contentType});\n          that.makeAmends(blob, that);\n        }\n      }\n    }\n    let dto = this.params;\n    if (dto) {\n      xhr.send(dto);\n    }\n  }\n\n  makeAmends(blob, that) {\n    that.blobUrl = window.URL.createObjectURL(blob);\n    let elm = document.createElement('a');\n    elm.href = that.blobUrl;\n    elm.download = this.fileName;\n    document.body.append(elm);\n    elm.click();\n    elm.remove();\n    window.URL.revokeObjectURL(that.blobUrl);\n    this.response.emit(this.message);\n  }\n\n  ngOnDestroy() {\n    this.urlPath = '';\n    this.methodType = 'GET';\n    this.params = '';\n    this.header = {};\n    this.fileName = 'myFile';\n    this.tagName = 'Download';\n    this.styleCss = '';\n    this.blobUrl = '';\n    this.message = {\"success\": true};\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { NgFileDownRestComponent } from './ng-file-down-rest.component';\n\n\n\n@NgModule({\n  declarations: [NgFileDownRestComponent],\n  imports: [\n  ],\n  exports: [NgFileDownRestComponent]\n})\nexport class NgFileDownRestModule { }\n"],"names":[],"mappings":"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"}